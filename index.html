<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>미션3 — 네트워크 상태 모니터링 대시보드</title>
  <style>
    :root{--bg:#f6f7fb;--card:#fff;--accent:#2b6cb0;--muted:#6b7280}
    *{box-sizing:border-box;font-family:Inter,\"Noto Sans KR\",system-ui,Apple SD Gothic Neo,\"Malgun Gothic\",sans-serif}
    body{margin:0;background:var(--bg);color:#0f1724;padding:24px}
    header{display:flex;gap:16px;align-items:center;margin-bottom:18px}
    header h1{font-size:20px;margin:0}
    .container{max-width:980px;margin:0 auto}
    .grid{display:grid;grid-template-columns:1fr 320px;gap:18px}
    .card{background:var(--card);border-radius:10px;padding:14px;box-shadow:0 6px 18px rgba(18,38,63,.06)}
    .small{font-size:13px;color:var(--muted)}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px}
    input,select,button{padding:8px 10px;border-radius:8px;border:1px solid #e6e9ef;background:white}
    button{cursor:pointer;background:var(--accent);color:white;border:none}
    #history{height:180px;overflow:auto;padding:8px;border-radius:8px;border:1px dashed #e6e9ef;background:#fbfdff}
    .metric{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid #f0f3f7}
    .metric:last-child{border-bottom:0}
    .dot{width:10px;height:10px;border-radius:50%;display:inline-block;margin-right:8px}
    .online{background:#22c55e}
    .warn{background:#f59e0b}
    .offline{background:#ef4444}
    canvas{width:100%;height:160px;border-radius:8px}
    footer{margin-top:14px;font-size:12px;color:var(--muted)}
    @media (max-width:840px){.grid{grid-template-columns:1fr;}.container{padding:6px}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>미션3 — 네트워크 상태 모니터링 대시보드</h1>
      <div class="small">간단한 웹 대시보드 (교육용, 실제 네트워크 명령은 서버 또는 로컬 도구 필요)</div>
    </header>

    <div class="grid">
      <!-- main -->
      <section class="card">
        <div class="small">대시보드 설명: ping, traceroute, nslookup 결과를 로그로 저장하고 그래프로 간단히 표시합니다.</div>

        <div class="controls" style="margin-top:12px;">
          <input id="target" placeholder="대상 호스트 또는 IP (예: google.com)" style="flex:1" value="google.com">
          <select id="interval">
            <option value="2">2초</option>
            <option value="5" selected>5초</option>
            <option value="10">10초</option>
          </select>
          <button id="startBtn">시작</button>
          <button id="stopBtn" disabled>중지</button>
        </div>

        <div style="display:flex;gap:12px;margin-top:12px;align-items:flex-start">
          <div style="flex:1">
            <canvas id="rttChart"></canvas>
            <div style="margin-top:8px;" class="small">RTT(가상값) 그래프 — 실제 ping은 브라우저에서 불가능해 시뮬레이션 값을 사용합니다.</div>
          </div>
          <div style="width:220px">
            <div class="small">최근 로그</div>
            <div id="history"></div>
          </div>
        </div>

        <hr style="margin:12px 0;border:none;border-top:1px solid #f0f3f7">
        <div class="small">도움말</div>
        <ul class="small">
          <li>ping: 목적지까지 왕복 지연 시간(RTT)을 측정합니다.</li>
          <li>traceroute: 목적지까지 거치는 라우터 경로를 확인합니다.</li>
          <li>nslookup: 도메인의 DNS 정보를 조회합니다.</li>
        </ul>
      </section>

      <!-- side -->
      <aside>
        <div class="card" style="margin-bottom:12px">
          <h3 style="margin:0 0 8px 0">요약 메트릭</h3>
          <div class="metric"><div><span class="dot online"></span>응답 정상</div><div id="okCount">0</div></div>
          <div class="metric"><div><span class="dot warn"></span>지연 높음 (&gt;300ms)</div><div id="slowCount">0</div></div>
          <div class="metric"><div><span class="dot offline"></span>응답 없음</div><div id="failCount">0</div></div>
        </div>

        <div class="card">
          <h3 style="margin:0 0 8px 0">수동 도구(샘플)</h3>
          <div class="small">브라우저는 보안 상 실제 ping/traceroute를 제공하지 못합니다. 아래는 교육용 시뮬레이션 버튼입니다.</div>
          <div style="display:flex;gap:8px;margin-top:10px">
            <button id="doPing">ping 시뮬레이션</button>
            <button id="doTrace">traceroute 시뮬레이션</button>
          </div>
          <div style="margin-top:10px" class="small">nslookup 예시:</div>
          <pre id="nslookup" style="background:#fbfdff;padding:8px;border-radius:6px;margin-top:6px">도메인: example.com\nA: 93.184.216.34</pre>
        </div>
      </aside>
    </div>

    <footer class="small">작성: 학생용 미니 프로젝트 — 이 페이지는 교육 목적으로만 제작되었습니다.</footer>
  </div>

  <script>
    // 간단한 차트 렌더러 (Canvas)
    const canvas = document.getElementById('rttChart');
    const ctx = canvas.getContext('2d');
    canvas.width = canvas.clientWidth * devicePixelRatio;
    canvas.height = canvas.clientHeight * devicePixelRatio;
    ctx.scale(devicePixelRatio, devicePixelRatio);

    let data = [];
    function drawChart(){
      const w = canvas.clientWidth;
      const h = canvas.clientHeight;
      ctx.clearRect(0,0,w,h);
      // 배경 그리기
      ctx.fillStyle = '#fff';
      ctx.fillRect(0,0,w,h);
      // 그리드
      ctx.strokeStyle = '#eef2f6';
      for(let i=0;i<5;i++){
        const y = (h/5)*i+10;
        ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(w,y);ctx.stroke();
      }
      // 선 그래프
      if(data.length>0){
        const max = Math.max(300, ...data.map(d=>d.rtt));
        const gap = w / Math.max(20, data.length-1);
        ctx.beginPath();
        ctx.strokeStyle = '#2b6cb0';ctx.lineWidth=2;
        data.forEach((d,i)=>{
          const x = i*gap;
          const y = h - ((d.rtt/max)*(h-20)) - 10;
          if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
        });
        ctx.stroke();
        // 점
        data.forEach((d,i)=>{
          const x = i*gap; const y = h - ((d.rtt/max)*(h-20)) - 10;
          ctx.beginPath();ctx.arc(x,y,3,0,Math.PI*2);ctx.fillStyle='#fff';ctx.fill();ctx.strokeStyle='#2b6cb0';ctx.stroke();
        });
      }
    }

    function addLog(text, level='ok'){
      const el = document.getElementById('history');
      const line = document.createElement('div');
      line.className='small';
      line.textContent = `[${(new Date()).toLocaleTimeString()}] ${text}`;
      el.prepend(line);
      // keep 100 lines
      while(el.childNodes.length>100) el.removeChild(el.lastChild);

      // update counts
      if(level==='ok') document.getElementById('okCount').textContent = Number(document.getElementById('okCount').textContent)+1;
      if(level==='slow') document.getElementById('slowCount').textContent = Number(document.getElementById('slowCount').textContent)+1;
      if(level==='fail') document.getElementById('failCount').textContent = Number(document.getElementById('failCount').textContent)+1;
    }

    // 시뮬레이션 함수
    function simulatePing(target){
      // rtt를 랜덤 생성 (교육용)
      const r = Math.random();
      let rtt;
      if(r<0.9) rtt = Math.round(20 + Math.random()*200); // 정상
      else if(r<0.97) rtt = Math.round(300 + Math.random()*400); // 느림
      else rtt = null; // 실패
      return {target, rtt};
    }

    // 주기적 체크 제어
    let timer = null;
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    startBtn.addEventListener('click',()=>{
      const interval = Number(document.getElementById('interval').value)*1000;
      const target = document.getElementById('target').value.trim() || 'example.com';
      if(timer) clearInterval(timer);
      timer = setInterval(()=>{
        const res = simulatePing(target);
        const entry = {time:Date.now(), rtt: res.rtt===null?9999:res.rtt};
        data.push(entry); if(data.length>60) data.shift();
        if(res.rtt===null){ addLog(`${target} 응답 없음`, 'fail'); }
        else if(res.rtt>300){ addLog(`${target} 지연 ${res.rtt}ms (느림)`, 'slow'); }
        else { addLog(`${target} 응답 ${res.rtt}ms`, 'ok'); }
        drawChart();
      }, interval);
      startBtn.disabled=true; stopBtn.disabled=false;
    });
    stopBtn.addEventListener('click',()=>{ clearInterval(timer); timer=null; startBtn.disabled=false; stopBtn.disabled=true;});

    // 수동 버튼
    document.getElementById('doPing').addEventListener('click',()=>{
      const target = document.getElementById('target').value||'example.com';
      const res = simulatePing(target);
      if(res.rtt===null){ addLog(`(수동) ${target} 응답 없음`,'fail'); }
      else addLog(`(수동) ${target} 응답 ${res.rtt}ms`,'ok');
      data.push({time:Date.now(), rtt: res.rtt===null?9999:res.rtt}); if(data.length>60) data.shift(); drawChart();
    });
    document.getElementById('doTrace').addEventListener('click',()=>{
      const sample = [
        '10.0.0.1', '192.168.0.1', '203.82.11.200', '108.177.10.139'
      ];
      addLog(`traceroute: ${sample.join(' -> ')}`,'ok');
    });

    // 초기 렌더
    drawChart();
  </script>
</body>
</html>
